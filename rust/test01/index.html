<html>
<body>

<div id = "msg"></div>

<script>

let msg_id = document.getElementById( "msg");
let result = NaN;
let finished = false;

msg_id.innerText = "not yet..";

WebAssembly.instantiateStreaming(
  fetch( "test01.wasm"), {})
    .then( wasm => {
      let add_func = wasm.instance.exports.add;
      result = add_func(10, 20);
      console.log( result);
      finished = true;
    }
);

console.log( "out of instantiateStreaming()");

console.log( result);

msg_id.innerText = result;

// sleep for <dur> millisec
// use like "await sleep( 1000);" in "async" function
function sleep( dur) {
  return new Promise(
    ( resolve) => {
      setTimeout( resolve, dur);
    } 
  );
}

await sleep( 1000);

if ( finished == true){

  console.log( "after finished");

  console.log( result);

  msg_id.innerText = result;

}

</script>

</body>
</html>
